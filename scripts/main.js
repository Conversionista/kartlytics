"use strict";function _defineProperty(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function gameIdGenerator(){"use stirct";var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function generateUserId(e){"use stirct";String.prototype.hashCode=function(){if(Array.prototype.reduce)return this.split("").reduce(function(e,n){return e=(e<<5)-e+n.charCodeAt(0),e&e},0);var e=0;if(0===this.length)return e;for(var n=0;n<this.length;n++){var a=this.charCodeAt(n);e=(e<<5)-e+a,e&=e}return e};var n=new Hashids,a=e.hashCode();return a=Math.abs(a),n.encode(a)}function registerPlayer(e,n,a){"use stirct";console.info("user registerd"),mixpanel.identify(generateUserId(e)),mixpanel.people.set({$first_name:n,$last_name:a,$email:e,$ip:geoplugin_request(),"Last login":dateTime}),mixpanel.people.set_once({"First Game":dateTime})}function trackGame(e,n,a,i,t){"use stirct";console.info("game registerd"),mixpanel.identify(generateUserId(n)),console.log(i),i=parseInt(i),15===i&&(mixpanel.people.increment("Gold Medals"),mixpanel.track("Gold Medal",{"Game ID":e,distinct_id:generateUserId(n),Cup:a,Mode:t})),12===i&&(mixpanel.people.increment("Silver Medals"),mixpanel.track("Silver Medal",{"Game ID":e,distinct_id:generateUserId(n),Cup:a,Mode:t})),10===i&&(mixpanel.people.increment("Bronze Medals"),mixpanel.track("Bronze Medal",{"Game ID":e,distinct_id:generateUserId(n),Cup:a,Mode:t})),mixpanel.people.increment("Total Score",i),mixpanel.people.increment("Games Played"),mixpanel.people.track_charge(i*t),mixpanel.track("Grand Prix",{"Game ID":e,distinct_id:generateUserId(n),Cup:a,Score:i,Mode:t})}function checkUserValues(){var e=grandPrixField.val(),n=modeField.val(),a=[],i=[],t="";if($(".player").each(function(e,n){var r=$(playerEmails[e]).val(),o=$(playerRanks[e]).val();0===r.length&&0===o.length||(0!==r.length&&0!==o.length?a.indexOf(r)===-1?(a.push(r),i.push(o)):t="ðŸ‘» <b>Sneaky there</b>, you can't register duplicates":t="ðŸ’¤ <b>Bummer</b>, it appears you left at least one field empty")}),0!==a.length)if(""!==t)swal({type:"warning",title:"Mate, please...",text:t,html:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Ok, lets try again"});else{var r;swal((r={title:"Are you sure?",text:"You are about to send data to Mixpanel.",type:"info",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, send it!",cancelButtonText:"No, cancel plx!"},_defineProperty(r,"showCancelButton",!0),_defineProperty(r,"closeOnConfirm",!1),_defineProperty(r,"showLoaderOnConfirm",!0),r),function(){$(a).each(function(a,t){trackGame(gameId,t,e,i[a],n)}),gameId=gameIdGenerator(),dateTime=(new Date).toISOString(),setTimeout(function(){swal({title:"Horray!",text:"Your scoring was sent to Mixpanel.",type:"success"})},2e3);var t=$("select").selectize();$.each(t,function(e){var n=t[e].selectize;n.clear()})})}else swal({type:"warning",title:"Doh!",text:"Obviously you haven't filled out anything...",html:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Ok, lets try again"})}function checkGameValues(){"use stirct";var e=grandPrixField.val(),n=modeField.val();e&&n?submitButton.attr("disabled",!1):submitButton.attr("disabled",!0)}function initSelectize(){grandPrixField.selectize({maxItems:1,persist:!1,valueField:"cup",labelField:"cup",searchField:["cup"],options:cups,sortField:"text",render:{item:function(e,n){var a=(formatName(e),e.cup);return'<span class="label">'+n(a)+"</span>"},option:function(e,n){var a=(formatName(e),e.cup);return'<div class="grand-prix"><img class="cup-icon cup-icon-'+n(a)+'" src="https://assets.conversionista.se/images/kartlytics/'+n(a)+'.png" width="60" height="60" /><span class="label">'+n(a)+"</span></div>"}}}),modeField.selectize({maxItems:1,persist:!1,valueField:"mode",labelField:"mode",searchField:["mode"],options:modes,sortField:"text"}),$(playerEmails).each(function(){$(this).selectize({persist:!1,maxItems:1,valueField:"email",labelField:"name",searchField:["fname","lname","email","nick"],sortField:[{field:"fname",direction:"asc"},{field:"lname",direction:"asc"}],options:players,render:{item:function(e,n){var a=formatName(e);return"<div>"+(a?'<span class="name">'+n(a)+"</span>":"")+(e.email?'<span class="email">'+n(e.email)+"</span>":"")+"</div>"},option:function(e,n){var a=formatName(e),i=a||e.email;a?e.email:null;return'<div class="name"><img src="https://www.gravatar.com/avatar/'+md5(n(e.email))+"?s=50&d="+encodeURIComponent("https://assets.conversionista.se/images/kartlytics/hero.jpg")+'"/><span class="label">'+n(i)+"</span></div>"}},createFilter:function(e){var n=new RegExp("^"+REGEX_EMAIL+"$","i"),a=new RegExp("^([^<]*)<"+REGEX_EMAIL+">$","i");return n.test(e)||a.test(e)},create:function(e){if(new RegExp("^"+REGEX_EMAIL+"$","i").test(e))return{email:e};var n=e.match(new RegExp("^([^<]*)<"+REGEX_EMAIL+">$","i"));if(n){var a=$.trim(n[1]),i=a.indexOf(" "),t=a.substring(0,i),r=a.substring(i+1);return{email:n[2],first_name:t,last_name:r}}return alert("Invalid email address."),!1}})}),$(playerRanks).each(function(){$(this).selectize({maxItems:1,persist:!1,valueField:"score",labelField:"rank",options:scores})})}function initEventListeners(){$(modeField).on("change",function(e){e.preventDefault(),checkGameValues()}),$(grandPrixField).on("change",function(e){e.preventDefault(),checkGameValues()}),$(submitButton).on("click",function(e){e.preventDefault(),checkUserValues()})}function setCookie(e,n,a){if(a!==!1){var i=new Date;i.setTime(i.getTime()+24*a*60*60*1e3);var t="; expires="+i.toGMTString();document.cookie=e+"="+n+t}document.cookie=e+"="+n}function getCookie(e){var n="; "+document.cookie,a=n.split("; "+e+"=");if(2===a.length){var i=a.pop().split(";").shift();return i}}function handleClientLoad(){gapi.load("client:auth2",initAuth)}function initAuth(){gapi.auth2.init({client_id:clientId,scope:scopes}).then(function(){auth2=gapi.auth2.getAuthInstance(),auth2.isSignedIn.listen(updateSigninStatus),updateSigninStatus(auth2.isSignedIn.get())})}function updateSigninStatus(e){if(e){$(".container").hide();var n=auth2.currentUser.get();aboutMe.fname=n.getBasicProfile().getGivenName(),aboutMe.lname=n.getBasicProfile().getFamilyName(),aboutMe.email=n.getBasicProfile().getEmail(),registerPlayer(aboutMe.email,aboutMe.fname,aboutMe.lname);var a=n.getBasicProfile().getGivenName(),i=n.getAuthResponse().id_token;$(".container").show(),verifyUser(i,a)}else $(".container").hide(),swal({title:"ðŸ‘‹ Well hello there",text:"Please sign in with your Google account to register as a player.",type:"info",html:!0,showConfirmButton:!0},function(e){handleAuthClick(e)})}function handleAuthClick(e){auth2.signIn()}function handleSignoutClick(e){auth2.signOut()}function showWelcome(){var e=void 0!==name&&0!==name.length?"Hello "+name+"!":"Hello!";swal({title:e,text:"You are all set â€“ <b>Best of luck!</b>",type:"success",timer:2e3,html:!0,allowEscapeKey:!0,allowOutsideClick:!0,showConfirmButton:!1}),$(".container").show()}function verifyUser(e,n){var a=$.ajax({url:endpoint+"?verifyUser="+e});a.done(function(e){e.hasOwnProperty("error_description")?swal({title:"Error",text:e.error_description,type:"error",allowEscapeKey:!1,allowOutsideClick:!1,showConfirmButton:!0}):showWelcome()}),a.fail(function(e){console.info(e),swal({title:"ðŸ˜” Bad news...",text:"Something broke behind the scenes. Please reload the page or try again later. Check the console for more details.",type:"error",allowEscapeKey:!1,allowOutsideClick:!1,showConfirmButton:!0})})}var players=[{email:"andreas.almqvist@conversionista.se",fname:"Andreas",lname:"Almqvist Gref",nick:"AG"},{email:"andreas@conversionista.se",fname:"Andreas",lname:"Nordin",nick:""},{email:"birgitta@conversionista.se",fname:"Birgitta",lname:"NordstrÃ¶m",nick:"Gitte"},{email:"carl@conversionista.se",fname:"Carl",lname:"Muszynski",nick:"Musse"},{email:"elin@conversionista.se",fname:"Elin",lname:"Linde",nick:""},{email:"erik@conversionista.se",fname:"Erik",lname:"Ã–hlÃ©n",nick:""},{email:"fredrik@conversionista.se",fname:"Fredrik",lname:"Degerman",nick:"Degis"},{email:"hannah@conversionista.se",fname:"Hannah",lname:"Kransell",nick:""},{email:"jens@conversionista.se",fname:"Jens",lname:"Svensson",nick:""},{email:"john@conversionista.se",fname:"John",lname:"Ekman",nick:"Chief Conversionista"},{email:"jonathan@conversionista.se",fname:"Jonathan",lname:"Kuronen",nick:""},{email:"kajsa@conversionista.se",fname:"Kajsa",lname:"Hedqvist",nick:""},{email:"katja@conversionista.se",fname:"Katja",lname:"Shershneva",nick:""},{email:"kim@conversionista.se",fname:"Kim",lname:"Dahlroth",nick:""},{email:"magnus@conversionista.se",fname:"Magnus",lname:"Svanblom",nick:""},{email:"maria@conversionista.se",fname:"Maria",lname:"Granath",nick:""},{email:"marie.edlund@conversionista.se",fname:"Marie",lname:"Edlund",nick:""},{email:"marie@conversionista.se",fname:"Marie",lname:"Horneman",nick:""},{email:"martin@conversionista.se",fname:"Martin",lname:"Lundvall",nick:""},{email:"niclas@conversionista.se",fname:"Niclas",lname:"Lundberg",nick:""},{email:"osborne@conversionista.se",fname:"Osborne",lname:"von Waldegg",nick:""},{email:"patrik@conversionista.se",fname:"Patrik",lname:"Matell",nick:"cyk0"},{email:"peter@conversionista.se",fname:"Peter",lname:"Jacobson",nick:""},{email:"sarah@conversionista.se",fname:"Sarah",lname:"Hoof",nick:"hoof1337"},{email:"seif@conversionista.se",fname:"Seif",lname:"Fendukly",nick:""},{email:"simon@conversionista.se",fname:"Simon",lname:"Dahla",nick:""}],cups=[{cup:"Mushroom"},{cup:"Flower"},{cup:"Star"},{cup:"Special"},{cup:"Shell"},{cup:"Banana"},{cup:"Leaf"},{cup:"Lightning"},{cup:"Egg"},{cup:"Triforce"},{cup:"Crossing"},{cup:"Bell"}],modes=[{mode:50},{mode:100},{mode:150},{mode:200}],scores=[{rank:1,score:15},{rank:2,score:12},{rank:3,score:10},{rank:4,score:9},{rank:5,score:8},{rank:6,score:7},{rank:7,score:6},{rank:8,score:5},{rank:9,score:4},{rank:10,score:3},{rank:11,score:2},{rank:12,score:1}];WebFont.load({typekit:{id:"fvc2tgi"}}),mixpanel.set_config({cross_subdomain_cookie:!0,cookie_name:"",cookie_expiration:365,track_pageview:!1,track_links_timeout:300,disable_cookie:!0,secure_cookie:!0,upgrade:!1});var formatName=function(e){return $.trim((e.fname||"")+" "+(e.lname||""))},nameField=$("#name"),grandPrixField=$("#grandPrix"),modeField=$("#mode"),rankField=$("#rank"),submitButton=$("#submit"),playerEmails=$('[name="email"]'),playerRanks=$('[name="rank"]'),gameId=gameIdGenerator(),dateTime=(new Date).toISOString(),REGEX_EMAIL="([a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?)";window.aboutMe=window.aboutMe||{},initSelectize(),initEventListeners();var endpoint="https://api.conversionista.se/gapi/",clientId="188686649588-pemricr51lakml69hcab3klrjcorb7hg.apps.googleusercontent.com",scopes="profile email phone",auth2;window.aboutMe=window.aboutMe||{};